# Chapter02 Rubyに関する基礎知識

## 基本的知識

- 全てがオブジェクト
- 変数名はスネークケースで書く

## 文字列

- シングルクオートとダブルクオートの違い
  - 文字列中に改行する場合は、ダブルクオートでないとダメ
  - その他のバックスラッシュ記法を使う場合もダブルクオートでないとダメ
  - 式展開する場合も、ダブルクオートでないとダメ

```rb
# 改行の例

puts "こんにちは\nさようなら"
#=> こんにちは
#   さようなら

puts 'こんにちは\nさようなら'
#=> こんにちは\nさようなら
```

```rb
# 式展開
name= 'Alice'
puts "こんにちは、#{name}"
#=> こんにちは、Alice

puts 'こんにちは、#{name}'
#=> こんにちは、#{name}
```

## 数値

数値には`_`を含めることができるので、区切りとして使うとよい。

```rb
1_000_000_000 #=> 1000000000
```

整数同士の割り算をすると、小数点以下が切り捨てされる。  
小数点以下の値が必要な場合、どちらかの値に小数点の「.0」を付ける。

```rb
# 小数点以下は切り捨てされる
1/2 #=> 0

# 小数点以下も表示される
1.0/2 #=> 0.5
```

なお、メソッドを使うことで、整数を少数に変換することができる。

```
n = 1
n.to_f #=> 1.0
```

べき乗を求める場合、`**`を使う。  
`2^3`と書くのかと思っていた。。。  

```rb
2**3 #=> 8
```

少数を使う場合は、丸め誤差に注意する必要がある。  
これは、コンピュータでは２進法で計算していることにより生じる問題らしい。  

```rb
0.１＊3.0 #=> 0.30000000000000004
```

よって、数値を比較する場合は注意する必要がある。  
このような場合、オブジェクトの型を有理数とするとよい。

```rb
# ２進法で計算しているため、falseとなる
0.1 * 3.0 == 0.3 #=> false

# rationalとして扱うとよい
0.1r * 3.0r == 0.3 #=> true

# rationalizeメソッドを使うとよい
a = 0.1
b = 3.0
a.rationalize * b.rationalize == 0.3 #=> true
```

## 真偽値と条件分岐

### True or False

- 偽:`false`と`nil`
- 真: それ以外

### 論理演算子

- `&&`は両方満たしているか確認いないと`false`として扱う
- `||`はどちらかを満たしていれば`true`として扱う

```rb
a = 5

# a > 6 を満たしていないので false
a > 2 && a > 6 #=> false

# a > 2 は満たしているので true
a > 2 || a > 6 #=> true
```

### メソッドの定義

メソッドの定義は以下のとおり行う。  

```rb
def メソッド名（引数1, 引数2)
  # 必要な処理
end
```

なお、引数がないこともある。
引数があったとしても、省略することができる。
ただし、引数がある場合は`( )`を書くのが一般的。


### returnは使わない

戻り値に関する情報は、メソッド定義に出てこない。  
最後に評価された式がメソッドの戻り値になる。  

```rb
def add(a, b)
  # return a + b とここで書くこともできるが、以下のとおり return を書かないのが一般的
  a + b
end
```

### Fizzbuzzをやってみる

def fizzbuzz(n)
  if n % 15 == 0
    "fizzbuzz"
  elsif n % 5 == 0
    "buzz"
  elsif n % 3 == 0
    "fizz"
  else
    n.to_s
  end
end

### 文字列についてもっと詳しく

#### % 記法

クオートの代わりに、％を使うこともできる。  
％の場合、クオート内のクオートなどをエスケープする必要がない。

調べると、色々ある。。。  
[リテラル \(Ruby 2\.7\.0 リファレンスマニュアル\)](https://docs.ruby-lang.org/ja/latest/doc/spec=2fliteral.html#percent)  

あと、配列を作ったり、シンボルにしたりできる。  
使いどころは思いついていないけど、何となく便利そう。  
[Rubyで%記法（パーセント記法）を使う \- Qiita](https://qiita.com/mogulla3/items/46bb876391be07921743)

```rb
# % → qなどの小文字 → ()などの記号で挟む
# シングルクオートで囲んだのと一緒
puts %q(He said, "Don't speak!")
```

#### ヒアドキュメント

複数行にわたる文字列を作成する場合、ヒアドキュメントを使うとよい。  

```rb
a = <<TEXT
上を向いて歩こう
涙がこぼれないように
思い出す　春の日
一人ぽっちの夜
TEXT
puts a

# これで、TEXTに囲まれている文字列を改行した状態で出力できる
# TEXTでなくても、同じ文字列なら何でもよいらしい
# 何行ものコードを出力する場合などに便利とのこと
# <<~TEXTとすると、先頭の空白行を無視することができる（ネストしている時に使うとよい）
# #{variable}といった式展開も使うことができる
```

#### フォーマットを指定して文字列を作成

```rb
# 小数点第３の位まで、数字を表示する
sprintf('%0.3f, 1.2') #=> 1.200
```

#### 条件演算子

以下の二つは同じ意味である。

```rb
n = 11
if n > 10
  '10より大きい'
else 
  '10以下'
end
```

```rb
n = 11
n > 10 ? '10より大きい' : '10以下'

# 「if => ?」、「else => :」と解釈する。 
```

### メソッド定義についてもっと詳しく

#### デフォルト値付きの引数

デフォルト値付きの引数は、以下のとおりコードを書く。  

```rb
def greeting(country = 'japan')
  if country == 'japan'
    'こんにちは'
  else
    'hello'
  end
end

# 引数がデフォルトで'japan'に設定されている
# よって、以下はこのような結果となる
greeting #=> 'こんにちは'
```

デフォルト値は、一部のみ設定することができる。

```rb
def default_args(a, b, c = 0, d = 0)
  "a=#{a}, b=#{b}, c=#{c}, d=#{d}"
end
default_args(1,2) #=> 1, 2, 0, 0
```

システム日時や他のメソッドの戻り値を引数に設定することもできる。  

```rb
def foo(time = Time.now, message = bar)
  puts "time: #{time}, message: #{message}"
end

def bar
  'BARRRR'
end

foo #=> time: 2020-06-24 09:00:21 +0900, message: BARRRR
```

#### ？で終わるメソッド

Rubyのメソッドは、慣例的に`?`を付けると真偽値を確認できるメソッドとなる。  

```rb
1.odd? #=> true
```
#### ！で終わるメソッド

！で終わるメソッドは、使用に当たって注意が必要。  
例えば、以下のメソッドは、オブジェクト自体を変更してしまうことから破壊的メソッドと呼ばれている。  

```rb
a = 'ruby'

# 破壊的メソッドではないので、a自体の値に変化はない
a.upcase #=> RUBY
a #=> ruby

# 破壊的メソッドにより、a自体の値が変化する
a.upcase! #=> RUBY
a #=> RUBY
```

#### 参照の概念を理解する

Rubyの変数には、オブジェクトそのものではなく、オブジェクトへの参照が格納されている。  
変数を他の変数に代入したりすると、新しい変数やメソッドの引数は元の変数と同じオブジェクトを参照する。  

分かりづらいと思うので、事例を記載。  

```rb
a = 'hello'
b = a

b.upcase!

# b だけでなく、a も HELLO になる
a #=> HELLO
b #=> HELLO
```

#### puts, print, p メソッド

それぞれ違いがある。  
`puts`と`print`は一般ユーザー向け、`p`は開発者向け。

```rb
puts 123
123
=> nil

print 123
123=> nil

p 123
123
```
