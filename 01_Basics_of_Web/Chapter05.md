# Chapter 5 - Webアプリケーションの基本

### ○ はじめに

Webアプリケーションの基本を理解するにあたって、以下についてまとめました。

    - 構造（３層構造とMVC)
    - WebアプリにおけるWebクライアントと各サーバーの役割
        - 各サーバーの機能（Web・AP・DB・Cache）
            - Ajax（サーバー間のやり取りを高速化する技術）
    - Web APIとマッシュアップ

就職先の企業では、Webアプリ開発に携わっていくことになるので、
このチャプターについての理解は特に深めていきたい。

### ○ アプリケーションの構造
#### ●　３層構造

Webアプリケーションは、以下の３層構造に分解される。
機能ごとに分けることによって、サーバーを分散して管理することができる。

なお、サーバー間でやり取りする際には、HTTPとは異なったプロトコルがある。
こちらについては、規格統一されていない。

    1. プレゼンテーション層
        - クライアントサイドに対して、HTMLなどを表示する機能を担う
        - クライアントサイドの操作を受け付ける
        - Webサーバーが対応する層
    2. アプリケーション層
        - データベースを取得し、動的にHTMLなどを生成し、プレゼンテーション層に送る
        - クライアントサイドからの操作を受け、データベースに反映する
        - APサーバーが担当する層
    3. データ層
        - アプリケーション層からの指示を受け、データの抽出・更新・保管を行う
        - DBサーバーが担当する

#### ●　MVCモデルとフレームワーク

３層構造は階層構造であり、プレゼンテーション層とデータ層が直接やり取りすることはないが、
MVCモデルにおいては、MVCの３者が直接やり取りしている。

    1. Model
        - Controllerからの指示を受け、DBを処理するところ
    2. View
        - Controllerからの指示を受け、クライアントに表示
        - その際、適宜DBを要求し、取得する
    3. Controller
        - ユーザーからの操作を受け、MVに指令を出す

このMVCモデルの部分をテンプレ化し、開発を容易にしたものをフレームワークという。
例としては、以下があげられる。
    - Java EE, Struts, Spring Boot
    - Larravel, Cake PHP
    - Ruby on Rails, Sinatra

フレームワークを使うことで、各機能ごとに分割して開発や改修を行うことができる。

### ○ WebアプリにおけるWebクライアントと各サーバーの役割

#### ●　Webクライアント
 
Webアプリケーションを利用すため、Webサーバとやり取りするプログラム。
雑にいうと、Webブラウザ。ただし、スマホアプリやデスクトップアプリも含まれる。

##### Ajax

なお、Ajaxという機能があるので、触れておく。
Ajax = Asynchronous JavaScript Xml の略称。

Asynchronous の意味するとおり非同期通信にて、XMLを先にダウンロードし、
Javascriptが適用できるようにする機能である。

HTML等を受信後、そのHTMLファイルベースにjavascriptを適用するよう動作が快適。

#### ●　各サーバーの機能（Web・AP・DB・Cache）

各機能について説明する。

##### Webサーバー

クライアントサイドにHTML等を表示させる機能や、クライアントサイドから情報を受け取る機能を担う。
アクセスが集中すると処理が追いつかないこともあるので、一般的には冗長化される。

Webサーバーに写真や動画等の静的コンテンツを置くこともあれば、別サーバーに置くこともある。
ただ、ネットワークを通しての処理には時間がかかるので、対策を取ることが必要。

##### APサーバー

アプリケーションサーバー。
クライアントから受け取った情報を元にして、適宜データを更新・取得し、動的にページを生成する。

ステートレスであるため、基本的には誰からの通信であるかは情報として保存していないことが多い。
とはいえ、それでは困ることがあるため一時的に session id を発行して、一連の処理を行うことがある。
この一連の処理のことをトランスアクションという。

##### DBサーバー

データベースサーバー。
データベースを管理するシステムであるDBMS（DataBase Management System）とストレージに分けられる。

データが失われると大変なため、冗長化されることが多い。
冗長化にも種類がある。
    - 同時更新の Mirror
    - 都度バックアップを取る Replication
    - ストレージは共有化してしまう Shared Disk Storage

##### Cacheサーバー

キャッシュとは、よくあるような情報のやり取りに関するデータを保管しておくことで、
通信のやり取りを高速化するための仕組みである。

Cache サーバーには、コンテンツサーバーとクエリサーバーがある。
コンテンツサーバーが動画などの表示するためのキャッシュは、コンテンツサーバーに置かれる。
データベースに関するキャッシュは、クエリサーバーに置かれる。

このキャッシュの仕組みをうまく利用するため、多くのサーバーをつなげて、
全世界のキャッシュサーバーのように活用しているのがCDNである。
CDNとは、Contents Delivery Network の略称。

### ○ Web API とマッシュアップ

#### ●　Web API

APIとは、Application Programmign Interface の略称。

例えば、位置情報をクライアントから取得し、そのデータを元に天気予報APIサーバーにアクセスし、
そこで得た天気情報を元にWebアプリケーションのサーバーが動的にHTML等を生成することができる。

プロトコルの変遷(RESTはプロトコルではないらしい)
- XML-RPC → SOAP → REST

#### ●　マッシュアップ

ウェブサービスを組み合わせて、いい感じにすること。
APIを組み合わせて、新しいサービスを開発することもできる。

とはいえ、そのAPIは開発者が任意で提供しているものなので、
その提供が中止されるとマッシュアップでできたサービスも動かなくなる。

